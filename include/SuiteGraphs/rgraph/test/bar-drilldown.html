<!DOCTYPE html >
<html>
<head>
    <link rel="stylesheet" href="demos.css" type="text/css" media="screen" />
    
    <script src="../libraries/RGraph.common.core.js" ></script>
    <script src="../libraries/RGraph.common.dynamic.js" ></script>
    <script src="../libraries/RGraph.common.effects.js" ></script>
    <script src="../libraries/RGraph.drawing.text.js" ></script>
    <script src="../libraries/RGraph.bar.js" ></script>
    
    <title>SuiteCRM Graphing</title>

</head>
<body>

    <h1>Test of n levels of drilldown</h1>

    <canvas id="cvs" width="550" height="250">[No canvas support]</canvas><br />
    
    <button id="butBack">Back to the top</button>

	<div id="breadcrumb"></div>
    
    <script>
        window.onload = function ()
        {
            var ca = document.getElementById("cvs");
            var data           = [3,6];
            var data_drilldown1 = [];
            var data_drilldown2 = [];


			var test = {
				"weekTotal":[2,10]
				,"weeks":[[1,1,0],[2,3,5]]
			}
			
			var sales = 
{
			"totals":[60,30],
			"sales":[
				
				{
				"name":"mrA",
				"week":[20,20,20],
				"day":[[1,2,3],[4,5,6],[7,8,9]]				
				},
				{
				"name":"mrsB",
				"week":[10,10,10],
				"day":[[3,2,1],[6,5,4],[9,8,7]]				
				},
			]
}			


            /**
            * The drilldown data - the order corresponds to that of the labels
            */
            data_drilldown1.push([1,1,1]);
            data_drilldown1.push([2,2,2]);
/*            data_drilldown1.push([1,1,1,2,3,2,2]);
            data_drilldown1.push([3,3,3,2,3,3,1]);
            data_drilldown1.push([4,3,1,1,3,2,2]);
            data_drilldown1.push([3,2,2,2,3,1,1]);
*/

			data_drilldown2.push([1]);
/*
            data_drilldown2.push([1,1,1,1,1,1,1]);
            data_drilldown2.push([2,2,2,2,2,2,2]);
            data_drilldown2.push([3,3,3,3,3,3,3]);
            data_drilldown2.push([4,4,4,4,4,4,4]);
            data_drilldown2.push([5,5,5,5,5,5,5]);
            data_drilldown2.push([6,6,6,6,6,6,6]);
            data_drilldown2.push([7,7,7,7,7,7,7]);
*/


//            var labels = ['John','Fred']
			var labels = [];
			for(var x = 0; x < sales.sales.length; x++)
				labels.push(sales.sales[x].name);

            var bar = drawMainChart();
            
            /**
            * Draws the main chart
            */
            function drawMainChart ()
            {
                RGraph.reset(ca);

                var bar = new RGraph.Bar({
                    id: 'cvs',
                    data: sales.totals,
                    options: {
                        labels: labels,
                        bevel: !RGraph.ISOLD,
                        title: 'The whole teams statistics for sales of widgets',
                        titleY:10,
                        backgroundGridAutofitNumvlines: data.length,
                        strokestyle:'rgba(0,0,0,0)'
                    }
                }).fadeIn();


            
                /**
                * When a bar is clicked show a more detailed breakdown
                */
                bar.onclick = function (e, shape)
                {
                    var obj = e.target.__object__;
                    var ca  = obj.canvas;
                    var idx1 = shape.index;

					document.getElementById("breadcrumb").innerHTML +=labels[idx];

                    /**
                    * Slide the old bar out
                    */
                    obj.fadeOut(null, function ()
                    {
                        RGraph.reset(ca);
    
						var labels1 = ['Mon','Tue','Wed']
                        var bar = new RGraph.Bar({
                            id: 'cvs',
                            data: test.weeks[idx1],
                            options: {
                                labels: labels1,
                                bevel: true,
                                strokestyle: 'rgba(0,0,0,0)',
                                titleY:10,
                                title: 'Specific statistics for: ' + labels[idx],
                                backgroundGridAutofitNumvlines: 7
                            }
                        }).fadeIn();
bar.onmousemove = function (e, shape)
                {
                    e.target.style.cursor = 'pointer';
                }

bar.onclick = function (e, shape)
                {
                    var obj = e.target.__object__;
                    var ca  = obj.canvas;
                    var idx2 = shape.index;
				var labels2 = ['A','B','C','D','E','F','G'];
				document.getElementById("breadcrumb").innerHTML +="<br>"+labels1[idx];

                    /**
                    * Slide the old bar out
                    */
                    obj.fadeOut(null, function ()
                    {
                        RGraph.reset(ca);
    
                        var bar = new RGraph.Bar({
                            id: 'cvs',
                            data: data_drilldown2[idx],
                            options: {
                                labels: labels2,
                                bevel: false,
                                strokestyle: 'rgba(0,0,0,0)',
//                                titleY:4,
                                title: 'Showing: ' + labels1[idx2],
                                backgroundGridAutofitNumvlines: 7
                            }
                        }).fadeIn();

                    });
                }
                

                    });
                }
                
                /**
                * The onmousemove event to change the cursor
                */
                bar.onmousemove = function (e, shape)
                {
                    e.target.style.cursor = 'pointer';
                }
                
                return bar;
            }
            
            document.getElementById("butBack").onclick = function (e)
            {
                var obj = ca.__object__;
				document.getElementById("breadcrumb").innerHTML = "";
                obj.fadeOut(null,function ()
                {
                    var bar = drawMainChart();
                });
            }
        };
    </script>

</body>
</html>
